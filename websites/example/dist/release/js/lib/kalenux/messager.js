function send(e){13!=e.keyCode||e.shiftKey||(sendMessage(),e.preventDefault())}function sendMessage(){var e=message_holder.value;e.replace(/\s/g,"").length&&(e={order_id:order_id,message:e},postJSON(messager_send_url,function(e,s){message_holder.value="",message_holder.focus(),getMessageCount()},e))}function getMessageCount(){var e;"undefined"!=typeof messager&&messager&&(e={order_id:order_id},postJSON(message_count_url,function(e){1===e.result&&message_count!=e.count&&loadNewMessages(0,e.count-message_count)},e))}function getMessages(){var e={start:message_start,limit:message_limit,order_id:order_id};postJSON(messager_url,function(e){1===e.result&&(message_count=e.count,setOldMessages(e.data),messages_holder.scrollBy({top:messages_holder.dataset.height,left:0}))},e)}function loadNewMessages(e,s){e={start:e,limit:s,order_id:order_id};postJSON(messager_url,function(e){1===e.result&&(message_count=e.count,setNewMessages(e.data),messages_holder.scrollBy({top:messages_holder.scrollHeight,left:0}))},e)}function loadOldMessages(){var e;0==messages_holder.scrollTop&&(e=document.getElementsByClassName("om-message").length,message_count>=e||(e={start:e,limit:message_limit,order_id:order_id},postJSON(messager_url,function(e){1===e.result&&(message_count=e.count,setOldMessages(e.data),messages_holder.scrollBy({top:messages_holder.dataset.height,left:0}))},e)))}function parseMessages(e){var s,t=e.length,a="";for(i=0;i<t;i++)a+="<div "+((s=e[i]).sender_id==user_id?'class="om-message om-sender"':'class="om-message om-receiver"')+" >"+s.message+'<span class="om-time">'+s.message_time+"</span></div>";return a}function setNewMessages(e){messages_holder.innerHTML+=parseMessages(e.reverse())}function setOldMessages(e){messages_holder.innerHTML=parseMessages(e.reverse())+messages_holder.innerHTML}firer.push(function(){message_count=0,messages_holder=document.getElementById("messages"),null!=(message_holder=document.getElementById("message"))&&(message_holder.onkeydown=send),int_boost_messages=setInterval(getMessageCount,15e3),messages_holder.onscroll=loadOldMessages});