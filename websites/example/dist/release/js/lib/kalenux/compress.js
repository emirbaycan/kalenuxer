function compressImage(e,t,r,n,i,a,f,o,s,g,l){var c,u,m=r.width,d=r.height;for(e<m&&(d=Math.round(e*d/m),m=e);;){if(u=(c=document.createElement("canvas")).getContext("2d"),0<o)switch(-1<[5,6,7,8].indexOf(o)?(c.width=d,c.height=m):(c.width=m,c.height=d),o){case 2:u.transform(-1,0,0,1,m,0);break;case 3:u.transform(-1,0,0,-1,m,d);break;case 4:u.transform(1,0,0,-1,0,d);break;case 5:u.transform(0,1,1,0,0,0);break;case 6:u.transform(0,1,-1,0,d,0);break;case 7:u.transform(0,-1,-1,0,d,m);break;case 8:u.transform(0,-1,1,0,0,m)}else c.width=m,c.height=d;if(u.fillStyle="rgba(0, 0, 0, 0)",u.fillRect(0,0,m,d),u.drawImage(r,0,0,m,d),null!=l&&(u.font="600 30px Arial",u.textAlign="center",u.fillStyle="rgba(255, 255, 255, 0.1)",u.fillText(l,m/2,d/2)),res=c.toDataURL(n,f),(size=7*res.length/8)<i&&size<s)return res;if((f-=g)<=0)return res}}function getOrientation(e,s,g){var t=new FileReader;t.onload=function(e){var t=new DataView(e.target.result);if(65496!=t.getUint16(0,!1))return g(-2,s);for(var r=t.byteLength,n=2;n<r;){var i=t.getUint16(n,!1);if(n+=2,65505==i){if(1165519206!=t.getUint32(n+=2,!1))return g(-1,s);var a=18761==t.getUint16(n+=6,!1),f=(n+=t.getUint32(n+4,a),t.getUint16(n,a));n+=2;for(var o=0;o<f;o++)if(274==t.getUint16(n+12*o,a))return g(t.getUint16(n+12*o+8,a),s)}else{if(65280!=(65280&i))break;n+=t.getUint16(n,!1)}}return g(-1,s)},t.readAsArrayBuffer(e.slice(0,65536))}function srcToFile(e,t,r,n){return fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return new File([e],n,{type:r})})}function compress(a,t,f,o){var e;"undefined"!=typeof FileReader&&((e=new FileReader).onload=function(e){var r=e.target.result,n=new Image,i=a.size;getOrientation(a,t,function(e,t){imgType=209715.2<i?"image/jpeg":a.type,n.onload=function(){srcToFile(r=compressImage(1920,1080,n,imgType,1048576,"#fff",.9,e,i,.1,f),"image."+imgType.split("/")[1],imgType,t).then(function(e){o(e,e.name)})}.bind(null,t),n.src=r})},e.readAsDataURL(a))}